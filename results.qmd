# Results and discussion
## EDA

```{r}
#| label: setup
#| include: false

library(tidyverse)

options(scipen = 12, digits = 5)

# Data preparation chain:
# Remove rows with no price
# Filter out prices < 20 000 and > 500 000
# Trim extra whitespace
# Create mark_model column and place it before fuel column
# Change column types
# Filter out cars with wrong first_in_traffic date as they have more erroneous values
# Create days_in_traffic column
# Filter out marks that have less observations than the number of features
# Convert to tibble

df <- read.csv("data/car_ads_data_02.csv") |> 
    dplyr::filter(!is.na(price)) |>
    dplyr::filter(price >= 20000 & price <= 500000) |>
    mutate(across(everything(), str_trim)) |>
    mutate(mileage = str_replace_all(mileage, "\\D", "")) |>
    unite(mark_model, mark:model,sep= " ", remove = FALSE) |>
    relocate(mark_model, .before = fuel) |>
    mutate(across(c(mark, model, mark_model, fuel, gearbox, type, drive, color, region), as.factor)) |>
    mutate(across(c(year, mileage, hp, motorsize, price), as.integer)) |>
    mutate(first_in_traffic = as.Date(first_in_traffic)) |>
    dplyr::filter(year(first_in_traffic) >= 1999) |>
    mutate(days_in_traffic = Sys.Date() - first_in_traffic) |>
    group_by(mark) |>
    mutate(avg_price= mean(price), count = n()) |>
    filter(count > length(df)) |>
    ungroup() |>
    as_tibble()
```


```{r}
#| label: fig-plot
#| fig-cap: "A plot"
ggplot(data = df, aes(x = days_in_traffic, y = price)) + 
    geom_point(aes(col = fuel, size = hp), alpha = .5) + 
    scale_x_continuous()

```

```{r}
#| eval: false
fig <- plot_ly(df, x = ~days_in_traffic, y = ~mileage, z = ~price, color = ~fuel, alpha = .75, type = "scatter3d", mode = "markers") |> 
    add_markers() |> 
    layout(title = "Used cars", scene = list(yaxis = list(type = "log", title = "Mileage")))
fig
```

### Considerations regarding data



## Results

## Discussion
### Legal and ethical issues regarding data mining
The data behind this analysis was collected using an automated method, often called *data mining* or *scraping*.

Blockets EULA (End User License Agreement) states the following regarding scraping their data [@blocket_eula]:

> Du har inte rätt att kopiera, reproducera, publicera, ladda upp, skicka eller distribuera något material eller någon information från Webbplatsen utan föregående skriftligt tillstånd från Blocket. (...)
> 
> Användning av automatiserade tjänster såsom robotar, spindlar, indexering eller liknande, samt andra metoder för systematisk användning av innehållet på Webbplatsen är inte tillåtet utan föregående skriftligt tillstånd från Blocket.
> 
> All otillåten användning medför ersättningsskyldighet. Den som avsiktligt eller genom grov oaktsamhet bryter mot lagen kan straffas med böter eller fängelse upp till två år och bli dömd att betala skadestånd.

Or, in english, (my translation and emphasis):

> You are not allowed to copy, reproduce, publish, upload, send or distribute any material or any information from the web site without prior written consent from Blocket. (...)
> 
> Use of automated services such as robots, spiders, indexing or the like, and other methods for systematic use of the web site's content is prohibited with prior written consent from Blocket.
> 
> Any prohibited use comes with an obligation to compensate. Anyone who, knowingly or by gross negligence, *breaks the law* can be punished by fine or prison for up to two years, and be ordered to pay damages.

It is not clear from the text which law is referred to. The EULA also states that Blocket owns the immaterial rights to any material such as text, images, design and information meda available by using the site. This, then would be a question of copyright law. It is however not immediately clear that the contents scraped from the web site is such that it would fall under copyright law. ^[citation needed]

Sweden is however a member of the European Union, and in 1996 the European Council approved the *Directive 96/9/EC of the European Parliament and of the Council of 11 March 1996 on the legal protection of databases*, [@eu_dir96/9].^[Check how it actually works]

The directive, amended in 2019, works as an analog to the copyright laws, and protects the rights of database creators and owners. This might be the law that is referred to in the Blocket EULA.

*Should probably write Blocket and ask them!*

* Difference b/w copyrighted material such as images, and information in a database. Also difference b/w US and European law.
* EU *sui generis* law protects database owners but exceptions could be made for research. @eu_dir96/9

### Data analysis

* Would new car price be a significant variable? We can only guess as we didn't include it.
* Collect the same data over time to find patterns
* Electric cars are underrepresented - what will that to to the data? <- Introduction?

### Parameter selection
Statistical methods vs. domain knowledge